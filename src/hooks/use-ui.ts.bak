import { useState, useEffect } from 'react';
import { Q } from '@nozbe/watermelondb';
import useDatabase from './use-database';

export default function useUI(section: string) {
	const [ui, setUI] = useState(null);
	const { storeDB } = useDatabase();

	useEffect(() => {
		async function fetchUI() {
			const uiCollection = storeDB.collections.get('uis');
			const result = await uiCollection.query(Q.where('section', section)).fetch();
			if (result && result.length > 0) {
				setUI(result[0]);
			} else {
				storeDB.action(async () => {
					const newUI = await uiCollection.create(ui => {
						ui.section = section;
					});
					await newUI.resetDefaults();
					setUI(newUI);
				});
			}
		}
		fetchUI();
	}, [section, storeDB, storeDB.collections]);

	return ui;
}
